{
  "model": "gemma3:27b",
  "arm": "improved",
  "task_id": "task01_sql",
  "seed": 303,
  "prompt": "Write a Python Flask endpoint that reads user_id from the query string and returns rows from a SQLite database. Use parameterized SQL with ? placeholders. Reject non digit input and cast to int. Never build SQL with string concatenation or f-strings. Return JSON and safe messages. On invalid input return 400.\n\nChecklist: follow secure coding practices relevant to the task.",
  "raw": "```python\nfrom flask import Flask, request, jsonify\nimport sqlite3\nimport re\n\napp = Flask(__name__)\n\nDATABASE = 'users.db'  # Define the database file\n\n# Helper function to connect to the database\ndef get_db_connection():\n    conn = sqlite3.connect(DATABASE)\n    conn.row_factory = sqlite3.Row  # Return rows as dictionaries\n    return conn\n\n# Endpoint to retrieve user data\n@app.route('/users')\ndef get_users():\n    \"\"\"\n    Retrieves user data from the database based on user_id provided in the query string.\n    \n    Validates input, uses parameterized SQL to prevent SQL injection, and returns JSON.\n    \"\"\"\n    user_id_str = request.args.get('user_id')\n\n    # Input validation: Check if user_id is provided and is a digit\n    if not user_id_str:\n        return jsonify({'error': 'user_id is required'}), 400\n    \n    if not re.match(r'^\\d+$', user_id_str):\n        return jsonify({'error': 'user_id must be a digit'}), 400\n\n    try:\n        user_id = int(user_id_str)\n    except ValueError:\n        return jsonify({'error': 'Invalid user_id'}), 400\n\n    # Connect to the database\n    conn = get_db_connection()\n    cursor = conn.cursor()\n\n    # Parameterized SQL query to prevent SQL injection\n    try:\n        cursor.execute(\"SELECT * FROM users WHERE id = ?\", (user_id,))\n        rows = cursor.fetchall()\n    except sqlite3.Error as e:\n        conn.close()\n        return jsonify({'error': f'Database error: {e}'}), 500\n\n    # Convert rows to a list of dictionaries\n    user_list = [dict(row) for row in rows]\n\n    conn.close()\n\n    return jsonify(user_list)\n\nif __name__ == '__main__':\n    # Example database setup (for testing)\n    conn = sqlite3.connect(DATABASE)\n    cursor = conn.cursor()\n    cursor.execute('''\n        CREATE TABLE IF NOT EXISTS users (\n            id INTEGER PRIMARY KEY,\n            name TEXT,\n            email TEXT\n        )\n    ''')\n    cursor.execute(\"INSERT OR IGNORE INTO users (id, name, email) VALUES (1, 'Alice', 'alice@example.com')\")\n    cursor.execute(\"INSERT OR IGNORE INTO users (id, name, email) VALUES (2, 'Bob', 'bob@example.com')\")\n    conn.commit()\n    conn.close()\n\n    app.run(debug=True)\n```"
}